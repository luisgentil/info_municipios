<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
<meta charset="utf-8">
<meta version="0.0.1">
<title>[QUERY]función comprobarEnWiki - action = query</title>
<!--link rel="stylesheet" type="text/css" href="css/mapas.css" /-->

<script type="text/javascript">

// Comprobar si existe una página concreta en Wikipedia
function comprobarEnWiki(pueblo) {
  var numerito = 0;
  var xmlhttp = new XMLHttpRequest();
  // cuando obtiene una respuesta ejecuta la function interna
  xmlhttp.onreadystatechange = function() {
    if (xmlhttp.readyState==4 && xmlhttp.status==200) {
      var respuesta = JSON.parse(xmlhttp.responseText);

      // -----PARA CASO CONSULTA ACTION=query------
      for (numero in respuesta.query.pages) {
        document.getElementById("init_LatLong").innerHTML = numero;
        var numerito = respuesta.query.pages[numero];
        document.getElementById("otra").innerHTML = respuesta.query.pages[numero].title;
        for (x in respuesta.query.pages[numero].revisions[0]) {
          if (x =="*"){
            var y = respuesta.query.pages[numero].revisions[0][x];
           // var z = JSON.parse(y);
           document.getElementById("texto").innerHTML = y;}
          
        if (numero > 0) {
        	console.log("numero:" + numero);
        }
         // 	return numero;} NOOOO: este return no es de la función comprobarEnWiki, sino de la function() interior, así que no podrá retornar nada la función principal. ¿Cómo saltar esto? la var numero solo exite dentro del for; 
          } 
       }
     } 
    }
  //
  var consulta = "https://es.wikipedia.org/w/api.php?action=query&titles=" + pueblo + "&prop=revisions&rvprop=content&format=json&origin=*";
  xmlhttp.open ("GET", consulta, false); // originalmente 'true', al ponerlo false SÍ funciona como quiero. Pero me da un mensaje de función deprecated, 
  xmlhttp.send();
  console.log(numero);
  return numero;

//  console.log(document.getElementById("init_LatLong").innerHTML);// el problema es que, antes de terminar la consulta, ya ha ejecutado esta linea, así que entrega el valor anterior, no el nuevo.

}

function cambiar() {
	var valor =  comprobarEnWiki("Sevilla"); // antes de terminar el cálculo sigue ejecutando, ¿y con while?
  //	if (valor == undefined) {
	 console.log("valor:" + valor);
	 document.getElementById("info_plus").innerHTML = valor; 
  //comprobarEnWiki(document.getElementById('submit').value)
	//console.log(document.getElementById("init_LatLong").innerHTML);
  //	}
  }

</script>
</head>

<body>
<h5>Ahora usa el pueblo = "Sevilla"</h5>

<input id="click" type="button" onclick = comprobarEnWiki(document.getElementById('submit').value) value="On">

<input id="submit" value="Sevilla">
<br>
<input id="otro" type="button" onclick = cambiar() value="otro">

<p>Al hacer click debería devolver el nº wiki del pueblo</p>

<div id="init_LatLong">inicial</div>

<div id="info_plus">al pulsar el botón "otro" debe cambiar al nº de wiki</div>

<div id="texto">texto</div>

</body>
</html>